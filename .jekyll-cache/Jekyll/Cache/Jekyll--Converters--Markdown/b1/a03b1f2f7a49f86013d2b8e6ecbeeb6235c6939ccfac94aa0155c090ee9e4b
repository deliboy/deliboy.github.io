I"à‰<p>ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„œëŠ” asp.net coreì—ì„œ graphql queryì— ëŒ€í•œ ê°€ì¥ ê¸°ì´ˆì ì¸ ë¶€ë¶„ì— ëŒ€í•´ ì•Œì•„ë³¸ë‹¤.</p>

<h2 id="ëª©ì°¨">ëª©ì°¨</h2>

<h4 id="graphqlì´ë€-ë¬´ì—‡ì¸ê°€">graphqlì´ë€ ë¬´ì—‡ì¸ê°€?</h4>
<p><a href="https://www.yalco.kr/24_graphql/">ì–„ì½”</a>
<a href="https://tech.kakao.com/2019/08/01/graphql-basic/">GraphQL ê°œë…ì¡ê¸°</a>
<a href="https://graphql.org/">ê³µì‹ì‚¬ì´íŠ¸</a>
<a href="https://chillicream.com/docs/hotchocolate">í•«ì´ˆì½œë¦¿</a></p>

<p>ê²°êµ­ graphqlì€ ì›¹ í™˜ê²½ì—ì„œ ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ê°„ì˜ ë°ì´í„° í†µì‹  ìŠ¤í‚¤ë§ˆë¥¼ ì˜(?) ì˜ ì •í•´ ë†“ê³  ì‚¬ìš©í•˜ìëŠ” ê²ƒ.</p>

<p>graphqlì„ ì²˜ìŒ ë´¤ì„ë•Œ ì´ê±´ ë˜ ë­ì•¼ ì•Œì•„ì•¼ í• ê»˜ ë˜ ìƒê²¼ë„¤ ì‹¶ì—ˆë‹¤. ê·¸ëŸ¬ë‹¤ ê³°ê³°ì´ ìƒê°í•´ë³´ë‹ˆ ì´ê±¸ ì ìš©í•˜ë©´ ê°œë°œìê°„ì˜ ë‹¤íˆ¼ì´ 
ì¤„ê² êµ¬ë‚˜ í•˜ëŠ” ìƒê°ì´ ë“¤ì—ˆë‹¤.</p>

<p>ì˜ˆì „ì—ëŠ” ì–´ë–»ê²Œ ë°ì´í„° ìŠ¤í‚¤ë§ˆë¥¼ ì •í–ˆëŠ”ì§€ ë‚´ê°€ í–ˆë˜ ê²½í—˜ì„ ì–˜ê¸°ë³´ê² ë‹¤.</p>

<ol>
  <li>clientê°€ dbì— ë°”ë¡œ ì¿¼ë¦¬ë¥¼ ë‚ ë¦¬ë˜ ì‹œì ˆì—ëŠ” í¬ë§·ì— ëŒ€í•œ ì´ìŠˆ ì—†ìŒ</li>
  <li>TCP-IP í†µì‹  ì‘ì„±í•  ë•Œ íŒ¨í‚· ì‚¬ì´ì¦ˆëŠ” ì–´ë–»ê²Œ í• ê²ƒ ì¸ê°€ ë¹…ì—”ë””ì–¸, ë¦¬í‹€ì—”ë””ì–¸ ë­˜ë¡œ í• ê±´ê°€ì— ëŒ€í•œ ì´ìŠˆ</li>
  <li>java corba ë“±ì¥ ì´ê²Œ ë‹¤ ì•‚ì–´ ë¨¹ì„ê²ƒ ê°™ì•˜ëŠ”ë° ë³„ê±° ì—†ì´ ëë‚¨.</li>
  <li>java rmi</li>
  <li>.net remoting service ê½¤ ì˜ ì‚¬ìš©í–ˆì§€ë§Œ xmlë¡œ ì§ë ¬í™” í• ì§€ binaryë¡œ ì§ë ¬í™” í• ì§€ì— ëŒ€í•œ ì‘ì€ ì´ìŠˆ</li>
  <li>wcf ë“±ì¥ ì´ê±¸ë¡œ í”„ë¡œì íŠ¸ í•œ ê²½í—˜ ì—†ìŒ ì´ë•Œ ì´ë¯¸ jsonìœ¼ë¡œ ëŒ€ë™ ë‹¨ê²°ë˜ì—ˆë˜ê²ƒ ê°™ìŒ</li>
  <li>ë°ì´í„° í¬ë§·ì€ json ëŒ€ë™ë‹¨ê²° back-end, front-end êµ¬ë¶„ì´ ëª¨í˜¸í•˜ë˜ ì‹œì ˆ ê°œë°œì ë§ˆìŒëŒ€ë¡œ í¬ë§· ì •í•¨</li>
  <li>restë“±ì¥ ë‚´ê°€ ìƒê°í•˜ëŠ” ê°€ì¥ ì“°ë ˆê¸° ê°™ì€ ë°©ì‹, ì™¸ë¶€ ì—°ë™ apië¥¼ í•´ë´ë„ ì •ë§ ê·œì¹™ë˜ë¡œ ëœê³³ì€ ì—†ìŒ
ë‚˜ë„ ì´ê·œì¹™ëŒ€ë¡œëŠ” ë„ì €íˆ ëª»í•˜ê² ìŒ. criteriaê°€ ë³µì¡í•œ ê²½ìš° ë¯¸ì³ë²„ë¦¼. ê²°êµ­ postë¡œ ë‹¤ ìš”ì²­í•¨</li>
  <li>í”„ë¡œì íŠ¸ë§ˆë‹¤ ë‚˜ë¦„ëŒ€ë¡œ í¬ë§· ê·œì¹™ ì •í•´ì„œ ì‚¬ìš©
    <h5 id="ì˜ˆ-ìš”ì²­">ì˜ˆ) ìš”ì²­</h5>
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
 <span class="dl">"</span><span class="s2">lastName</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">kim</span><span class="dl">"</span><span class="p">,</span>
 <span class="dl">"</span><span class="s2">checkinDate</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">2020-01-08</span><span class="dl">"</span><span class="p">,</span>
 <span class="dl">"</span><span class="s2">checkoutDate</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">2020-01-09</span><span class="dl">"</span><span class="p">,</span>
 <span class="dl">"</span><span class="s2">status</span><span class="dl">"</span><span class="p">:</span><span class="mi">18</span><span class="p">,</span>
 <span class="dl">"</span><span class="s2">nation</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">KR</span><span class="dl">"</span>
<span class="p">}</span>
</code></pre></div>    </div>
    <h5 id="ì‘ë‹µ">ì‘ë‹µ</h5>
    <div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
 <span class="dl">"</span><span class="s2">results</span><span class="dl">"</span><span class="p">:[{....},{....},{....}]</span>
 <span class="dl">"</span><span class="s2">isError</span><span class="dl">"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span>
 <span class="dl">"</span><span class="s2">exception</span><span class="dl">"</span><span class="p">:{</span>
 	<span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span>
     <span class="dl">"</span><span class="s2">message</span><span class="dl">"</span><span class="p">:</span><span class="kc">null</span><span class="p">,</span>
 <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>graphqlë“±ì¥ 9ì— í–ˆë˜ ìŠ¤í‚¤ë§ˆë¥¼ í”„ë¡œì íŠ¸ë§ˆë‹¤ê°€ ì•„ë‹ˆë¼ graphqlì˜ ë„ì›€ì„ ë°›ì•„ì„œ ì¼ì›í™” í•  ìˆ˜ ìˆìŒ.
graphqlë„ ë§ŒëŠ¥ì€ ì•„ë‹˜, íŠ¹ì •ì–¸ì–´ì— êµ­í•œëœê²Œ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ì œì•½ ì‚¬í•­ì´ ê½¤ ìˆê³ , ê°„ë‹¨íˆ ì²˜ë¦¬ í•  ìˆ˜ ìˆëŠ” ë¶€ë¶„ì„ 
ë³µì¡í•´ì§ˆ ìˆ˜ë„ ìˆì§€ë§Œ, ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ëŠ” ì´ë¯¸ ìŠ¤í‚¤ë§ˆê°€ ì •í•´ì¡Œê¸° ë•Œë¬¸ì— ê·œì¹™ëŒ€ë¡œë§Œ ê°œë°œí•˜ë©´ë¨. 
ê·¸ë¦¬ê³  ORMì„ ì‚¬ìš©ì‹œ entity ê°ì²´ë¥¼ clientê¹Œì§€ ì‚¬ìš©í• ì§€ í•­ìƒ ê³ ë¯¼ë˜ëŠ”ë° ê³ ë¯¼ì—†ì´ ë¬´ì¡°ê±´ VO, DTOë¥¼ ì°ìœ¼ë©´ë¨</li>
</ol>

<h3 id="1-nuget-downlaod">1. nuget downlaod</h3>

<h3 id="2-ê¸°ë³¸ì ì¸-ì½”ë“œ-ì‘ì„±">2. ê¸°ë³¸ì ì¸ ì½”ë“œ ì‘ì„±</h3>
<ul>
  <li>entity ì‘ì„±
    <ul>
      <li>Member.cs</li>
    </ul>
  </li>
  <li>dto ì‘ì„±
    <ul>
      <li>MemberSearchRequest.cs</li>
      <li>MemberVO.cs</li>
    </ul>
  </li>
  <li>ì„œë¹„ìŠ¤ ë° ë¦¬íŒŒì§€í† ë¦¬ í´ë˜ìŠ¤ ì‘ì„±
    <ul>
      <li>PensionService.cs</li>
      <li>MemberRepository.cs</li>
    </ul>
  </li>
</ul>

<h3 id="3-startupcs-ìˆ˜ì •">3 Startup.cs ìˆ˜ì •</h3>

<h3 id="4-graphql-test">4 graphql test</h3>

<h3 id="5-ë¬¸ì œì ">5 ë¬¸ì œì </h3>

<h3 id="6-í•´ê²°ë°©ë²•">6 í•´ê²°ë°©ë²•</h3>
<hr />
<h2 id="ë³¸ë¬¸">ë³¸ë¬¸</h2>

<h3 id="1-nuget-downlaod-1">1. nuget downlaod</h3>
<blockquote>
  <p>â€œHotChocolate.AspNetCoreâ€ Version=â€11.3.7â€</p>
</blockquote>

<h3 id="2-ê¸°ë³¸ì ì¸-ì½”ë“œ-ì‘ì„±-1">2. ê¸°ë³¸ì ì¸ ì½”ë“œ ì‘ì„±</h3>
<p>** - entity ì‘ì„±**
<em>Member.cs</em></p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">MyPension.Entities</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Member</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">long</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">DateTime</span> <span class="n">BirthDay</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Email</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>** - vo  (<em>MemberVO.cs</em>)**</p>
<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">MyPension.Entities</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">MyPension.Dtos.VO</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">MemberVO</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="nf">MemberVO</span><span class="p">(</span><span class="n">Member</span> <span class="n">entity</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Name</span> <span class="p">=</span> <span class="n">entity</span><span class="p">.</span><span class="n">Name</span><span class="p">;</span>
            <span class="n">Id</span> <span class="p">=</span> <span class="n">entity</span><span class="p">.</span><span class="n">Id</span><span class="p">;</span>
            <span class="n">BirthDay</span> <span class="p">=</span> <span class="n">entity</span><span class="p">.</span><span class="n">BirthDay</span><span class="p">.</span><span class="n">Date</span><span class="p">;</span>
            <span class="n">Email</span> <span class="p">=</span> <span class="n">entity</span><span class="p">.</span><span class="n">Email</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">long</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="n">DateTime</span> <span class="n">BirthDay</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Email</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>** - ê²€ìƒ‰ criteria request  (<em>MemberSearchRequest.cs</em>)**</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">namespace</span> <span class="nn">MyPension.Dtos.Requests</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">MemberSearchRequest</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="kt">long</span><span class="p">?</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Email</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>** - Repository  (<em>MemberRepository.cs</em>)**</p>

<blockquote>
  <p>ì—¬ê¸°ì„œëŠ” ì‹¤ì œ DBì— ì ‘ê·¼í•˜ëŠ”ê²Œ ì•„ë‹Œ mock ë°ì´í„°ë¡œ í…ŒìŠ¤íŠ¸</p>
</blockquote>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">MyPension.Dtos.Requests</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">MyPension.Dtos.VO</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">MyPension.Entities</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">MyPension.Repositories</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">MemberRepository</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">MemberVO</span><span class="p">&gt;</span> <span class="nf">Search</span><span class="p">(</span><span class="n">MemberSearchRequest</span> <span class="n">request</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">byId</span> <span class="p">=</span> <span class="n">request</span><span class="p">.</span><span class="n">Id</span><span class="p">;</span>
            <span class="kt">var</span> <span class="n">byName</span> <span class="p">=</span> <span class="n">request</span><span class="p">.</span><span class="n">Name</span><span class="p">;</span>
            <span class="kt">var</span> <span class="n">byEmail</span> <span class="p">=</span> <span class="n">request</span><span class="p">.</span><span class="n">Email</span><span class="p">;</span>

            <span class="kt">var</span> <span class="n">query</span> <span class="p">=</span> <span class="nf">GetMocks</span><span class="p">().</span><span class="nf">AsQueryable</span><span class="p">();</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">byId</span><span class="p">.</span><span class="n">HasValue</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">query</span> <span class="p">=</span> <span class="n">query</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Id</span> <span class="p">==</span> <span class="n">byId</span><span class="p">.</span><span class="n">Value</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(!</span><span class="n">String</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">byName</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="n">query</span> <span class="p">=</span> <span class="n">query</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">byName</span><span class="p">));</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(!</span><span class="n">String</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">byEmail</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="n">query</span> <span class="p">=</span> <span class="n">query</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Email</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">byEmail</span><span class="p">));</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="c1">//voì˜ ìƒì„±ìë¡œ entityë¥¼ ë˜ì§„ë‹¤.</span>
            <span class="c1">//voë¥¼ ë§Œë“œëŠ” ì—¬ëŸ¬ê°€ì§€ ë°©ë²•ì´ ìˆì§€ë§Œ ì •ë‹µì€ ì—†ë‹¤.</span>
            <span class="kt">var</span> <span class="n">results</span> <span class="p">=</span> <span class="n">query</span><span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="nf">MemberVO</span><span class="p">(</span><span class="n">x</span><span class="p">));</span>

            <span class="k">return</span> <span class="n">results</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">/// &lt;summary&gt;</span>
        <span class="c1">/// í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ë§Œë“¤ì</span>
        <span class="c1">/// &lt;/summary&gt;</span>
        <span class="c1">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Member</span><span class="p">&gt;</span> <span class="nf">GetMocks</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">List</span><span class="p">&lt;</span><span class="n">Member</span><span class="p">&gt;</span> <span class="n">mock</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Member</span><span class="p">&gt;();</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">1000</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">mock</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">Member</span>
                <span class="p">{</span>
                    <span class="n">BirthDay</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">.</span><span class="nf">AddYears</span><span class="p">(-</span><span class="m">50</span><span class="p">).</span><span class="nf">AddMonths</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                    <span class="n">Email</span> <span class="p">=</span> <span class="s">$"jindalre</span><span class="p">{</span><span class="n">i</span><span class="p">}</span><span class="s">@gmail.com"</span><span class="p">,</span>
                    <span class="c1">//í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ idê°’ì„ í°ê°’ìœ¼ë¡œë„ ë§Œë“¦</span>
                    <span class="n">Id</span> <span class="p">=</span> <span class="n">i</span> <span class="p">%</span> <span class="m">2</span> <span class="p">==</span> <span class="m">0</span> <span class="p">?</span> <span class="kt">long</span><span class="p">.</span><span class="n">MaxValue</span> <span class="p">-</span> <span class="n">i</span> <span class="p">:</span> <span class="n">i</span><span class="p">,</span>
                    <span class="n">Name</span> <span class="p">=</span> <span class="s">$"kim abc </span><span class="p">{</span><span class="n">i</span><span class="p">}</span><span class="s">"</span>
                <span class="p">});</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">mock</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>** - Service (<em>PensionService.cs</em>)**</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">MyPension.Dtos.Requests</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">MyPension.Dtos.VO</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">MyPension.Repositories</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">MyPension.Services</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">PensionService</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">MemberRepository</span> <span class="n">_memberRepository</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">PensionService</span><span class="p">(</span><span class="n">MemberRepository</span> <span class="n">memberRepository</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">_memberRepository</span> <span class="p">=</span> <span class="n">memberRepository</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">MemberVO</span><span class="p">&gt;</span> <span class="nf">SearchMember</span><span class="p">(</span><span class="n">MemberSearchRequest</span> <span class="n">request</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">_memberRepository</span><span class="p">.</span><span class="nf">Search</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="3-startupcs-ìˆ˜ì •-1">3 startup.cs ìˆ˜ì •</h3>
<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">void</span> <span class="nf">ConfigureServices</span><span class="p">(</span><span class="n">IServiceCollection</span> <span class="n">services</span><span class="p">)</span>
<span class="p">{</span>
	<span class="p">............</span>
	<span class="c1">// Graphql serverë“±ë¡</span>
	<span class="n">services</span><span class="p">.</span><span class="nf">AddGraphQLServer</span><span class="p">().</span><span class="n">AddQueryType</span><span class="p">&lt;</span><span class="n">MyPension</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">PensionService</span><span class="p">&gt;();</span>
	<span class="c1">// ì„œë¹„ìŠ¤ ë“±ë¡</span>
	<span class="n">services</span><span class="p">.</span><span class="n">AddScoped</span><span class="p">&lt;</span><span class="n">MyPension</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">PensionService</span><span class="p">&gt;();</span>
	<span class="c1">// ë¦¬íŒŒì§€í† ë¦¬ ë“±ë¡</span>
	<span class="n">services</span><span class="p">.</span><span class="n">AddScoped</span><span class="p">&lt;</span><span class="n">MyPension</span><span class="p">.</span><span class="n">Repositories</span><span class="p">.</span><span class="n">MemberRepository</span><span class="p">&gt;();</span>
<span class="p">}</span>
<span class="k">public</span> <span class="k">void</span> <span class="nf">Configure</span><span class="p">(</span><span class="n">IApplicationBuilder</span> <span class="n">app</span><span class="p">,</span> <span class="n">IWebHostEnvironment</span> <span class="n">env</span><span class="p">)</span>
<span class="p">{</span>
	<span class="p">............</span>
     <span class="n">app</span><span class="p">.</span><span class="nf">UseRouting</span><span class="p">().</span><span class="nf">UseEndpoints</span><span class="p">(</span><span class="n">endpoints</span> <span class="p">=&gt;</span>
	<span class="p">{</span>
		<span class="n">endpoints</span><span class="p">.</span><span class="nf">MapGraphQL</span><span class="p">();</span>
	<span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>
<h3 id="4-graphql-test-1">4 graphql test</h3>
<p><strong>ì‹¤í–‰</strong></p>
<blockquote>
  <p>http://localhost:5000/graphql/ ì—ì„œ ì•„ë˜ graphql query ì‘ì„± í›„ ì‹¤í–‰</p>
</blockquote>

<div class="language-graphql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">query</span><span class="p">{</span><span class="w">
  </span><span class="n">results</span><span class="p">:</span><span class="n">searchMember</span><span class="p">(</span><span class="n">request</span><span class="p">:{</span><span class="n">name</span><span class="p">:</span><span class="s2">"kim"</span><span class="p">}){</span><span class="w">
    </span><span class="n">id</span><span class="p">,</span><span class="w">
    </span><span class="n">name</span><span class="p">,</span><span class="w">
    </span><span class="n">birthDay</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><strong>ê²°ê³¼</strong></p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">results</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="mi">9223372036854776000</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">kim abc 0</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">birthDay</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">1971-09-09T00:00:00.000+09:00</span><span class="dl">"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">kim abc 1</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">birthDay</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">1971-10-09T00:00:00.000+09:00</span><span class="dl">"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="mi">9223372036854776000</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">kim abc 2</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">birthDay</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">1971-11-09T00:00:00.000+09:00</span><span class="dl">"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">kim abc 3</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">birthDay</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">1971-12-09T00:00:00.000+09:00</span><span class="dl">"</span>
      <span class="p">},</span>
<span class="p">........</span>      
</code></pre></div></div>

<h3 id="5-ë¬¸ì œì -1">5. ë¬¸ì œì </h3>
<p>ì›í•˜ëŠ” ê²°ê³¼ê°€ ë‚˜ì™”ëŠ”ê°€? ê·¸ë ‡ì¹˜ ì•Šë‹¤. 2ê°€ì§€ ë¬¸ì œì ì´ ìˆëŠ”ë°</p>
<ol>
  <li>í° ìˆ˜ì— ëŒ€í•œ idê°’ì´ ì˜ë ¤ìˆë‹¤.</li>
  <li>ë‚ ì§œë§Œ í•„ìš”í•œë° ì‹œê°„ë„ ê°™ì´ ë‚˜ì™”ë‹¤.</li>
</ol>

<p>idê°’ì˜ íƒ€ì…ì€ longì¸ë° javascriptì˜ number íƒ€ì…ì€ ì˜¨ì „íˆ 8byte ìˆ«ìë¥¼ ë‹´ì„ ìˆ˜ ì—†ì–´ì„œ ë’·ìë¦¬ê°€ 000ìœ¼ë¡œ ëŒ€ì²´ ëœë‹¤.
birthDayê°’ì€ ë‚ ì§œë§Œ ì›í•˜ëŠ”ë° ì‹œê°„ í¬ë§·ê³¼ +09:00ì˜ system zoneì˜ offsetê°’ë„ ê°™ì´ ì¶œë ¥ë˜ì—ˆë‹¤.</p>
<h5 id="cì€-ë‚ ì§œíƒ€ì…ì´-datetimeë§Œ-ìˆê³ -dateí˜•ì´-ë”°ë¡œ-ì¡´ì¬í•˜ì§€ëŠ”-ì•ŠëŠ”ë‹¤"><em>c#ì€ ë‚ ì§œíƒ€ì…ì´ DateTimeë§Œ ìˆê³  Dateí˜•ì´ ë”°ë¡œ ì¡´ì¬í•˜ì§€ëŠ” ì•ŠëŠ”ë‹¤.</em></h5>

<h5 id="ì°¸ê³ ë¡œ-graphqlì—ì„œì˜-ë‚ ì§œëŠ”-iso-8061-ê·œì¹™ì„-ë”°ë¥¸ë‹¤-iso-8061">ì°¸ê³ ë¡œ graphqlì—ì„œì˜ ë‚ ì§œëŠ” ISO 8061 ê·œì¹™ì„ ë”°ë¥¸ë‹¤. <a href="https://ko.wikipedia.org/wiki/ISO_8601">ISO 8061</a></h5>

<h3 id="6-í•´ê²°ë°©ë²•-1">6. í•´ê²°ë°©ë²•</h3>
<p>graphqlì—ì„œ ì§€ì›í•˜ëŠ” Scralars íƒ€ì…ì€ ì•„ë˜ 5ê°œê°€ ì „ë¶€ì´ë©° ê·¸ë‚˜ë§ˆ IDëŠ” Stringì— ëŒ€í•œ aliasì— ë¶ˆê°€í•˜ë‹¤.
String, Boolean, Int, Float, ID
ì¦‰ Boolean, Int, Floatë¥¼ ì œì™¸í•œ ëª¨ë“  íƒ€ì…ì€ ëª¨ë‘ ë¬¸ìì´ë‹¤.
ê·¸ëŸ¬ë©´ ì´ì œ í•´ê²° ë°©ë²•ì¤‘ ê°€ì¥ ê°„ë‹¨í•œ ë°©ë²•ì„ ì•Œì•„ë³´ì</p>
<ol>
  <li>idê°’ long typeë¬¸ì œ
Startup.csì˜ ì„¤ì •ì„ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•œë‹¤.</li>
</ol>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">services</span><span class="p">.</span><span class="nf">AddGraphQLServer</span><span class="p">()</span>
         <span class="p">.</span><span class="n">AddQueryType</span><span class="p">&lt;</span><span class="n">MyPension</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">PensionService</span><span class="p">&gt;()</span>
         <span class="p">.</span><span class="n">BindRuntimeType</span><span class="p">&lt;</span><span class="kt">long</span><span class="p">,</span> <span class="n">HotChocolate</span><span class="p">.</span><span class="n">Types</span><span class="p">.</span><span class="n">StringType</span><span class="p">&gt;();</span>
</code></pre></div></div>
<hr />
<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">BindRuntimeType</span><span class="p">&lt;</span><span class="kt">long</span><span class="p">,</span> <span class="n">StringType</span><span class="p">&gt;</span> <span class="kt">long</span> <span class="err">íƒ€ì…ì„</span> <span class="n">String</span> <span class="err">íƒ€ì…ìœ¼ë¡œ</span> <span class="err">ì¸ì‹ì‹œì¼œì¤€ë‹¤</span><span class="p">.</span>
</code></pre></div></div>

<ol>
  <li>ë‚ ì§œ í˜•ì‹ ë¬¸ì œ
ì„¸ ê°€ì§€ ì •ë„ í•´ê²°ë°©ë²•ì´ ìˆë‹¤.
    <ol>
      <li>attributeë¥¼ ì‚¬ìš©í•´ì„œ DateTime typeì„ HotCholate.Types.DateTypeìœ¼ë¡œ ë³€í™˜</li>
      <li>ObjectTypeì„ ìƒì†ë°›ì•„ì„œ Graphqlìš© typeì„ ì¬ì •ì˜</li>
      <li>Query Resolverì—ì„œ DateTime í˜•ì„ Stringìœ¼ë¡œ ë³€í™˜</li>
    </ol>
  </li>
</ol>

<p>ìœ„ ë°©ë²•ì¤‘ 2, 3ë²ˆì€ ê¸°ì¡´ ì†ŒìŠ¤ì½”ë“œë¥¼ ë³€ê²½í•´ì•¼ í•˜ë¯€ë¡œ ë‹¤ìŒì— ì•Œì•„ë³´ê³  1ë²ˆ ë°©ë²•ì„ ì„¤ëª…í•˜ê² ë‹¤.</p>

<p><em>MemberVO.cs</em></p>
<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="nf">GraphQLType</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">HotChocolate</span><span class="p">.</span><span class="n">Types</span><span class="p">.</span><span class="n">DateType</span><span class="p">))]</span>
<span class="k">public</span> <span class="n">DateTime</span> <span class="n">BirthDay</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</code></pre></div></div>

<p><strong>ìˆ˜ì • í›„ ê²°ê³¼</strong></p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
  <span class="dl">"</span><span class="s2">data</span><span class="dl">"</span><span class="p">:</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">results</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">9223372036854775807</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">kim abc 0</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">birthDay</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">1971-09-09</span><span class="dl">"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">1</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">kim abc 1</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">birthDay</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">1971-10-09</span><span class="dl">"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">9223372036854775805</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">kim abc 2</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">birthDay</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">1971-11-09</span><span class="dl">"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">3</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">kim abc 3</span><span class="dl">"</span><span class="p">,</span>
        <span class="dl">"</span><span class="s2">birthDay</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">1971-12-09</span><span class="dl">"</span>
      <span class="p">},</span>
<span class="p">......</span>      
</code></pre></div></div>
:ET